# Devices API Spring Application - V1

This project is a RESTful API for managing devices. It is built using Java, Spring Boot, and Maven, and it uses PostgreSQL as the database. The project is containerized using Docker and Docker Compose.

## Prerequisites

- Java 21
- Maven
- Docker
- Docker Compose

## Getting Started

### Clone the Repository

git clone https://github.com/Glaydson/devicesapi.git
cd devicesapi

```sh
git clone https://github.com/Glaydson/devicesapi.git
cd devicesapi
```


## Run DevicesApi locally

DevicesApi is a [Spring Boot](https://spring.io/guides/gs/spring-boot) application built using [Maven](https://spring.io/guides/gs/maven/). You can build a jar file and run it from the command line:

```bash
git clone https://github.com/Glaydson/devicesapi.git
cd devicesapi
./mvnw package
java -jar target/*.jar
```

## Run in a Docker Container   

To run the application using Docker Compose, execute the following command:

```sh
docker-compose up --build
```

This will start the application and the PostgreSQL database.

### Access the API

The API will be available at `http://localhost:8082/api/devices`.

## API Endpoints

- `POST /api/v1/devices`: Create a new device.
- `GET /api/v1/devices/{id}`: Get a device by ID.
- `GET /api/v1/devices`: Get all devices.
- `GET /api/v1/devices/search`: Search devices by name, brand, and state.
- `PUT /api/v1/devices/{id}`: Update a device by ID.
- `DELETE /api/v1/devices/{id}`: Delete a device by ID.

## Configuration

### Database Configuration

The database configuration is located in the `src/main/resources/application-postgres.properties` file:

```ini
database=postgres
spring.datasource.url=${POSTGRES_URL:jdbc:postgresql://localhost/devicesapi}
spring.datasource.username=${POSTGRES_USER:postgres}
spring.datasource.password=${POSTGRES_PASS:postgres}
spring.sql.init.mode=always
```

### Docker Configuration

The Docker configuration is located in the `docker-compose.yml` file. It defines two services: `server` and `db`.

## Database Schema

The database schema is defined in the `src/main/resources/db/postgres/schema.sql` file:

```sql
DROP TABLE IF EXISTS devices;

CREATE TABLE devices (
  id            INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name          VARCHAR(100) NOT NULL,
  brand         VARCHAR(100) NOT NULL,
  state         VARCHAR(50) NOT NULL,
  creation_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## Model

The `Device` model is defined in the `src/main/java/com/glaydson/devicesapi/model/Device.java` file:

```java
@Entity
@Table(name = "devices")
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@ToString
public class Device {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "name", nullable = false)
    private String name;

    @Column(name = "brand", nullable = false)
    private String brand;

    @Enumerated(EnumType.STRING)
    @Column(name = "state", nullable = false)
    private State state;

    @Column(name = "creation_time", updatable = false)
    private LocalDateTime creationTime;

    public enum State {
        AVAILABLE,
        IN_USE,
        INACTIVE
    }
}
```

## Controller

The `DeviceController` is defined in the `src/main/java/com/glaydson/devicesapi/controller/DeviceController.java` file:

```java
@RestController
@RequestMapping("/api/v1/devices")
public class DeviceController {
    // Controller methods
}
```
## Logging
The application uses the SLF4J logging facade and the Logback logging framework. The log configuration is located in the `src/main/resources/logback-spring.xml` file.

## Business Rules
Some business rules were implemented in this version:
- Creation time of a device can not be updated.
- Properties name and brand of a device can not be updated if the device is in use.
- A device in use can not be deleted.

## Backlog
- Implement internationalization.
- Add security to the endpoints.
- Add more tests.
- Implement a frontend application.
- Implement a CI/CD pipeline.
- Implement a monitoring system.
- 

## License

This project is licensed under the MIT License.